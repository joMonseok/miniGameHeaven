import screen
import os

map1 =[
        ['┌','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┬','─','┐'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['├','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┼','─','┤'],
        ['└','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┴','─','┘']
    ]

map2 = [[0 for _ in range(19)] for _ in range(19)]
black=1
white=2
dol = black


cursor_x, cursor_y = 1, 1
dolx, doly = 0, 0
gameIng = True

def on_press():
    global cursor_x, cursor_y, doly, dolx, dol, gameIng
    key = screen.getKey()  # 키 입력 대기 (1byte 입력받기)
    # 전역 변수 사용
    if key == 'w':  # W: 위로 이동
        cursor_y = max(1, cursor_y - 1)  # 위쪽 경계값 제한
        doly = max(0, doly - 1)
    elif key == 's':  # S: 아래로 이동
        cursor_y = min(19, cursor_y + 1)  # 아래쪽 경계값 제한
        doly = min(18, doly + 1) 
    elif key == 'a':  # A: 왼쪽으로 이동
        cursor_x = max(1, cursor_x - 2)  # 왼쪽 경계값 제한
        dolx = max(0, dolx - 1) 
    elif key == 'd':  # D: 오른쪽으로 이동
        cursor_x = min(37, cursor_x + 2)  # 오른쪽 경계값 제한
        dolx = min(18, dolx + 1) 
    elif key == 'l':
        if map2[doly][dolx]==0:
            map2[doly][dolx] = dol
            if winChk(dolx,doly):
                gameIng=False
            else:
                if dol==black:
                    dol=white
                else:
                    dol=black



def winChk(x,y):
    right=0
    left=0
    up=0
    down=0
    riup=0
    rido=0
    leup=0
    ledo=0

    directions = [
        (0, 1), (0, -1), (1, 0), (-1, 0),  # 오른쪽, 왼쪽, 아래, 위
        (1, 1), (1, -1), (-1, 1), (-1, -1)  # 우하단, 좌하단, 우상단, 좌상단
        ]


    right = chkDol(x+1,y,1,0,dol,right)
    left = chkDol(x-1,y,-1,0,dol,left)
    up = chkDol(x,y-1,0,-1,dol,up)
    down = chkDol(x,y+1,0,1,dol,down)
    riup = chkDol(x+1,y-1,1,-1,dol,riup)
    rido = chkDol(x+1,y+1,1,1,dol,rido)
    leup = chkDol(x-1,y-1,-1,-1,dol,leup)
    ledo = chkDol(x-1,y+1,-1,1,dol,ledo)
    
    if right + left + 1 > 4:
        return True
    elif up + down + 1 >4:
        return True 
    elif riup + ledo + 1 >4:
        return True
    elif rido + leup + 1 >4:
        return True
    return False

def chkDol(x,y,plusX,plusY,dol,wei):
    if map2[y][x]==dol:
        wei = chkDol(x+plusX,y+plusY,plusX,plusY,dol,wei+1)
    return wei

def drawMap():
    screen.move_cursor_to(0,0)
    for i in range(0,19,1):
        j2=0

        for j in range(0,37,1):
            startStr = ""
            str = ""
            lastStr = ""
            if i==cursor_y-1 and j==cursor_x-1:
                startStr="\033[1;34m"
                lastStr="\033[0m"
            if j%2==0:
                if map2[i][j2]!=0:
                    if map2[i][j2]==black:
                        str='○'
                    elif map2[i][j2]==white:
                        str='●'
                else:
                    str=map1[i][j]
                j2=j2+1
            else:
                str = map1[i][j]
            startStr= startStr+str+lastStr
            print(startStr,end="")
        print("\r")


def main():
    global gameIng
    for i in range(0,19,1):
        for j in range(0,19,1):
            map2[i][j]=0
    drawMap()
    while gameIng:
        screen.move_cursor_to(cursor_x, cursor_y)
        on_press()
        drawMap()
    
    screen.move_cursor_to(0, 20)
    if dol==white:
        print("흰색 승")
    else:
        print("블랙 승")
    on_press()
    gameIng = True
